---
title: "1_finding_output_theme"
format: html
editor: visual
---

## Shiny app created by chatgpt

Order: I want to create a visually appealing map format and develop a shiny app where you can mark points on the map by inputting coordinates. How can I do this?

```{r}
install.packages(c("shiny", "leaflet"))
```
```{r}
library(shiny)
library(leaflet)

ui <- fluidPage(
  titlePanel("ğŸ“ è¾“å…¥åæ ‡åœ¨åœ°å›¾ä¸Šæ‰“ç‚¹"),
  
  sidebarLayout(
    sidebarPanel(
      numericInput("lat", "çº¬åº¦ (Latitude):", value = 39.90, step = 0.001),
      numericInput("lng", "ç»åº¦ (Longitude):", value = 116.40, step = 0.001),
      textInput("label", "æ ‡ç­¾ (å¯é€‰):", value = "æ ‡è®°ç‚¹"),
      actionButton("add", "æ·»åŠ ç‚¹"),
      actionButton("clear", "æ¸…é™¤æ‰€æœ‰ç‚¹"),
      hr(),                                 ### âœ… ä¿®æ­£ï¼ˆåŸå…ˆç¼ºé€—å·ï¼‰
      uiOutput("point_list_ui")             ### æ–°å¢ï¼šæ˜¾ç¤ºæ‰€æœ‰æ ‡æ³¨ç‚¹çš„é€‰æ‹©æ¡†
    ),
    
    mainPanel(
      leafletOutput("map", height = "600px")
    )
  )
)

server <- function(input, output, session) {
  # åˆå§‹åŒ–åœ°å›¾
  output$map <- renderLeaflet({
    leaflet() %>%
      addProviderTiles(providers$CartoDB.Positron) %>%  # åœ°å›¾æ ·å¼
      setView(lng = 116.40, lat = 39.90, zoom = 4)
  })
  
  # å­˜å‚¨ç‚¹æ•°æ®
  points <- reactiveVal(data.frame(lat = numeric(), lng = numeric(), label = character()))
  
  # æ·»åŠ ç‚¹
  observeEvent(input$add, {
    new_point <- data.frame(lat = input$lat, lng = input$lng, label = input$label, stringsAsFactors = FALSE)
    points(rbind(points(), new_point))
    
    leafletProxy("map") %>%
      addMarkers(
        lng = input$lng,
        lat = input$lat,
        popup = input$label,
        layerId = input$label  # æ–°å¢ï¼šä¸ºæ¯ä¸ªç‚¹è®¾ç½® layerIdï¼ˆç”¨äºåç»­å®šä½ï¼‰
      )
  })
  
  # æ¸…é™¤ç‚¹
  observeEvent(input$clear, {
    points(data.frame(lat = numeric(), lng = numeric(), label = character()))
    leafletProxy("map") %>% clearMarkers() %>% clearPopups()    ### ä¿®æ”¹ï¼šåŒæ—¶æ¸…é™¤ popup
  })
  
  # æ–°å¢ï¼šåŠ¨æ€ç”Ÿæˆæ ‡æ³¨ç‚¹åˆ—è¡¨
  output$point_list_ui <- renderUI({
    pts <- points()
    if (nrow(pts) == 0) {
      helpText("æš‚æ— æ ‡æ³¨ç‚¹")
    } else {
      selectInput("selected_point", "å¿«é€Ÿå®šä½æ ‡æ³¨ç‚¹ï¼š", 
                  choices = pts$label, selected = NULL)
    }
  })
  
  # ä¿®æ”¹ï¼šå½“ç”¨æˆ·åœ¨ä¸‹æ‹‰æ¡†ä¸­é€‰æ‹©ç‚¹æ—¶ï¼Œåœ°å›¾è‡ªåŠ¨è·³è½¬å¹¶æ˜¾ç¤º popupï¼ˆç”¨ clearPopups + addPopupsï¼‰
  observeEvent(input$selected_point, {
    req(input$selected_point)
    pts <- points()
    sel <- pts[pts$label == input$selected_point, ]
    if (nrow(sel) == 1) {
      leafletProxy("map") %>%
        setView(lng = sel$lng, lat = sel$lat, zoom = 10) %>%
        clearPopups() %>%                                    ### æ–°å¢/ä¿®æ”¹ï¼šå…ˆæ¸…é™¤ç°æœ‰å¼¹çª—
        addPopups(lng = sel$lng, lat = sel$lat, popup = sel$label)  ### æ–°å¢ï¼šä»¥ addPopups æ˜¾ç¤ºå¼¹çª—
    }
  })
}

shinyApp(ui, server)
```

